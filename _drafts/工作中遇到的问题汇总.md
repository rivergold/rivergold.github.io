# Python

## numpy数据转化

```python
a = np.zeros((2, 2), np.uint8)
a[0, 0] = 300.11
print(a)
>>> array([[44,  0],
       [ 0,  0]], dtype=uint8)
```

```python
a[0, 0] = 256
print(a)
>>> array([[0, 0],
       [0, 0]], dtype=uint8)
```

**请注意这一点**

如果np.ndarray中的数据大于255，需要转化为整数时，请使用`astype(np.int32)`或者`astype(np.uint32)`。请注意位数，如果使用`astype(np.uint8)`则会出现数据溢出！


## OpenCV build with Cuda

## Numpy `copy` and `view`

***References:***

- [Blog: Numpy Views vs Copies: Avoiding Costly Mistakes](http://www.jessicayung.com/numpy-views-vs-copies-avoiding-costly-mistakes/)

## Path.glob

Path.glob('*') 不会包含`.` `..`

## Python字符串包含双引号

Ref [CSDN: Python中，怎么在字符串里嵌入双引号或者单引号](https://blog.csdn.net/linshenwei1995/article/details/78987444)

## python -m `` 的问题

RuntimeWarning: 'dataset.reg_dataset' found in sys.modules after import of package 'dataset', but prior to execution of 'dataset.reg_dataset'; this may result in unpredictable behaviour
  warn(RuntimeWarning(msg))

自己总结的经验：
- 如果想要执行package中的module，使用`python -m <pakcage name>.<module_name>`：
   - 请不要在package中的__init__.py中import这个module，否则该module会被执行两遍：第一次实在import这个package时，第二次是你的执行package.module时，这是还会出现`RuntimeWarning: 'dataset.reg_dataset' found in sys.modules after import of package 'dataset', but prior to execution of 'dataset.reg_dataset'; this may result in unpredictable behaviour
  warn(RuntimeWarning(msg))`的warning

Ref [Medium: Python 的 Import 陷阱](https://medium.com/pyladies-taiwan/python-%E7%9A%84-import-%E9%99%B7%E9%98%B1-3538e74f57e3)


### Script 与 module的区别

本质上没有区别，只是script会有`__name__ == '__main__'`，而module一般是被别的文件import的

Ref [stackoverflow: What is the difference between a module and a script in Python?](https://stackoverflow.com/questions/2996110/what-is-the-difference-between-a-module-and-a-script-in-python)

# shell

## bash与sh区别

`test.sh`:

```shell
#!/bin/sh

a=10
b=20

if [ $a == $b ]
then
   echo "a is equal to b"
else
   echo "a is not equal to b"
fi
```

When run `sh test.sh`, occur `run.sh: 6: [: 10: unexpected operator`

`sh` not support `==`

Ref [stackoverflow: [:Unexpected operator in shell programming [duplicate]](https://stackoverflow.com/a/3411105/4636081)

`#!/bin/bash` will work when run `./test.sh`

<!--  -->
<br>

***

<br>
<!--  -->

# Android开发

## `Build APKS`操作可以实现对动态库进行“抽取”

原本编译出来的libtensorflowlite有50多MB，进行build apks生成的apk中包含的动态库只有几百k。

单独使用CMake，脱离android studio编译出来的库也可以通过build apks实现动态库的抽取

<!--  -->
<br>

***

<br>
<!--  -->

# 变量命名
- 对于带修饰词的变量，i.e `img_scaled`， 将修饰词放置后面
- 一般变量，使用组合名词表示

# Other

编写visualier时，需要将tensor转化为numpy，出现error
```
Traceback (most recent call last):
  File "train.py", line 121, in <module>
    train(opt)
  File "train.py", line 107, in train
    visualizer.plot_images(x, y_hat)
  File "src/utils/visualizer.py", line 105, in plot_images
    kps = tensor2kps(kps_tensor[s_id])
  File "src/utils/utils.py", line 67, in tensor2kps
    kps = kps.numpy().reshape(-1, 2)
RuntimeError: Can't call numpy() on Variable that requires grad. Use var.detach().numpy() instead.
```

`detach` do what:

Ref [CSDN: pytorch: Variable detach 与 detach_](https://blog.csdn.net/u012436149/article/details/76714349): 该链接所写的，值得研究！

- [PyTorch doc: `torch.Tensor`](https://pytorch.org/docs/stable/autograd.html#torch.Tensor.detach)

<br>

***

<br>

## git ignore file by path

我的repo里面有两个名叫dataset的文件夹，我想忽略根目录下的。如果在`.gitignore`写`dataset/`会将两个都忽略，需要改写为`/dataset/`来根据路径进行忽略

ref [segmentfault: .gitignore 如何仅忽略根目录下的index.html](https://segmentfault.com/q/1010000004064190)

## 3D模型基本概念

- [Unity doc: Materials, Shaders & Textures](https://docs.unity3d.com/Manual/Shaders.html)

- [AUTODESK MAYA 2017 帮助](http://help.autodesk.com/view/MAYAUL/2017/CHS/?guid=GUID-FDCD0C68-2496-4405-A785-3AA93E9A3B25)

### UV

Ref [博客园: 理解UV贴图](https://www.cnblogs.com/jiahuafu/p/6831330.html)

## 3D人脸重建

参数化3D人脸模型：人脸参数、blendshape参数
2D图像人脸关键点检测 -> 3D模型投影（需要计算相机参数）-> 误差计算

<br>

***

<br>

# Python提升GPU利用率

## 减少花费在CPU上的数据预处理时间
  
### 使用多核CPU处理

Python get cpu count:

- `os.cpu_count()`
- `multiprocessing.cpu_count()`

Ref [stackoverflow: How to find out the number of CPUs using python](https://stackoverflow.com/a/25636145/4636081)

给PyTorch中的Dataloader设置`num_workers`

Ref [PyTorch Forum: How to speed up the data loader](https://discuss.pytorch.org/t/how-to-speed-up-the-data-loader/13740/6?u=rivergold)

- [ ] `pin_memory=True` 细节；测试时，1w的数据集没有明显提升GPU使用率

## 使用HDF5存储训练数据

Ref [PyTorch Forum: How to speed up the data loader](https://discuss.pytorch.org/t/how-to-speed-up-the-data-loader/13740/3?u=rivergold)

- [ ] 有待调研

## 有用的资料

- [Medium: Speed Up your Algorithms Part 1 — PyTorch](https://towardsdatascience.com/speed-up-your-algorithms-part-1-pytorch-56d8a4ae7051)
- [SAGIVTECH: Optimizing PyTorch training code](https://www.sagivtech.com/2017/09/19/optimizing-pytorch-training-code/)

<br>

***

<br>

# Visdom

## Visdom save and reshow

### Visdom save `env` as `.json`

<p align="center">
  <img
  src="https://upload-images.jianshu.io/upload_images/9890707-6a8de499029d7001.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" width="100%">
</p>

### Visdom reshow from `.json`

```bash
$ visdom -env_path <folder contain .json>
```

Ref [Github facebookresearch: visdom](https://github.com/facebookresearch/visdom#usage)

<br>

***

<br>

# ssh

## [建议]使用`alias`建立登陆远程虚拟机的的快捷键
```bash
alias="ssh root@<ip>"
```

## Use zssh

### Install

- Ubuntu: `sudo apt install zssh`

Ref [博客园: linux 机器之间 zssh, rz, sz互相传输](https://www.cnblogs.com/strikebone/p/3454679.html)

### Use

Remote server (usually CentOS), need install `lrzsz`

```bash
yum install lrzsz
```

Ref [CSDN: linux CentOS 安装rz和sz命令 lrzsz](https://blog.csdn.net/jack85986370/article/details/51321475)

#### Upload

1. `ctr + @`: 切换到local
2. `sz <file>`: 从local上传文件到remote

#### Download

1. `sz <file>` 在remote启动sz，准备发送文件
2. `ctr + @`: 切换到local
3. `cd <path>`: 进入到需要存储的路径
4. `rz`: 接受文件

***References:***

- [Blog: zssh使用](https://phenix3443.github.io/notebook/ubuntu/zssh.html)

<!--  -->
<br>

***

<br>
<!--  -->

# `rm`与`trash`

`rm`操作存在风险，建议使用`trash`替代`rm`

最好在`~/.zshrc`中配置：

```bash
alias rm='echo "rm is disabled, use trash or /bin/rm instead."
```

Ref [CommandLinefu.com: Disable rm, use trash instead](https://www.commandlinefu.com/commands/view/10118/disable-rm-use-trash-instead)

之后安装`trash-cli`

```bash
$ sudo apt install trash-cli
```

Ref [Linux公社：Ubuntu命令行的垃圾箱Trash CLI，远离 rm 命令误删除重要文件的阴影](https://www.linuxidc.com/Linux/2018-11/155406.htm)

## Where is `Trash` location

- User trash directory is `~/.local/share/Trash`

- If you deleted something as root: `/root/.local/share/Trash`

Ref [StackExchange: Where is the .Trash folder?](https://askubuntu.com/questions/102099/where-is-the-trash-folder)

## trash-cli基本使用

- `trash <file or folder>`: trash file or folder into trash

- `trash-restore`: resotre file deleted from current folder

# `zip` and `7z`

## Zip many files into several archives

***References:***

- [StackExchange: Zip many files into several archives](https://superuser.com/a/602711)
- [StackExchange: How could I portably split large backup files over multiple discs?](https://superuser.com/questions/602735/how-could-i-portably-split-large-backup-files-over-multiple-discs/602736#602736)

# `fd`

Ref [简书: fd - 更好的 find 命令](https://www.jianshu.com/p/cfe79da128bc)

# 动态库信息查看

```bash
$ readelf -d <.so> | grep 'NEEDED'
```

Ref [StackExchange: How to find out the dynamic libraries executables loads when run?](https://unix.stackexchange.com/a/220110)

# `pip`

`pip install`: 没有`-y`的参数
`pip uninstall`: 有`-y`的参数

# git

## 合并单个commit

use `cherry-pick`

## 合并多个commit

- [ ] 有待研究

Gitkraken中使用`Squash`实现。
Ref [GitKraken doc: Squash](https://support.gitkraken.com/working-with-commits/squash/).

**注意:** 如果remote如果已经有了你需要合并的commit记录，那只能只用`force push`来达到remote修改历史commit的目的。请谨慎操作

Ref [CSDN: Git合并特定commits 到另一个分支](https://blog.csdn.net/ybdesire/article/details/42145597)

# 评价标注

## Accuracy, Precision and Recall

Ref [简书: 准确率(Accuracy) | 查准率(Precision) | 查全率(Recall)](https://www.jianshu.com/p/8b7324b0f307)

## map

Ref [知乎: 目标检测中的mAP是什么含义？](https://www.zhihu.com/question/53405779/answer/419532990)

## P-R曲线

Ref [简书: 二战周志华《机器学习》-PR曲线和ROC曲线](https://www.jianshu.com/p/75a163a17fb5)

## TP, TN, FP, FN

Ref [CSDN: TP FN FP TN](https://blog.csdn.net/power0405hf/article/details/50421088)

<!--  -->
<br>

***

<br>
<!--  -->

# Python `argparse`

[Here is an example.](https://gist.github.com/rivergold/381fda065a4d36d17645e96427ddf878)

## Can not use `sys.argv`

使用`parser.parse_args(args)`可以从`['value', 'key1', 'value1', ...]`中进行解析

Ref [stackoverflow: Python error: the following arguments are required](https://stackoverflow.com/questions/51172076/python-error-the-following-arguments-are-required)

## `add_subparsers`

- [ ] 有待深入了解；需求：一个参数根据另一个参数出现会作为必要选项

***References:***

- [kite: add_subparsers](https://kite.com/python/docs/argparse.ArgumentParser.add_subparsers)
- [stackoverflow: Python Argparse - conditionally required arguments based on the value of another argument](https://stackoverflow.com/questions/52086550/python-argparse-conditionally-required-arguments-based-on-the-value-of-another)

# Warm start

> 值得一提的是模型的热启动（warm start）问题。热启动解决的是模型需要长时间训练才能收敛的问题，这个时候可以用一个已经训练好的模型，从中选取一些共同的特征权重，作为模型的初始状态，这样可以使得模型更快收敛，从而加快训练速度。

Ref [知乎: 一分钟整明白Tensorflow Extended](https://zhuanlan.zhihu.com/p/31041536)

- [ ] warm up的含义

<!--  -->
<br>

***

<br>
<!--  -->

# Pytorch

## `optimizer`

- `param_groups`: `list`
- `param_groups[0]`: `dict`

```python
for param_group in param_groups:
    print(type(param_group))
>>> <class 'dict'>
```

- [ ] Adam optimizer的参数: `dict_keys(['lr', 'betas', 'eps', 'weight_decay', 'amsgrad', 'params'])`

## `Conv`

```python
conv = torch.nn.Conv2d(3, 24, 3)
conv.weight.size()
>>> torch.Size([24, 3, 3, 3])
#

conv = torch.nn.Conv2d(3, 24, (4, 5))
conv.weight.size()
>>> torch.Size([24, 3, 4, 5])
```

conv2d weight tensor size: `[C_out, C_in, K_h, K_w]`

# 模型重新训练

训练是需要存储的有：

- 网络的参数
- 优化器的参数
- lr-scheduler的参数
- 当前的步数（主要用于显示、lr-decay的计算；但一般lr-sheduler中会自己计数）

使用以上的参数基本可以恢复当时的训练场景。

如果想要warm-start（在之前训练的checkpoint的基础之上，调整优化策略、lr decay的方式）的话：restore以下参数

- 模型参数
- 优化器参数（如果没有更换优化器）

之后重新配置lr-scheduler

即可

# `retval`

OpenCV读取视频会出现`retval`: return value

Ref [retval是什么意思，python](https://zhidao.baidu.com/question/2143728724379292388.html)

# Docker

Using the RUN instruction in a Dockerfile with `source` does not work.
https://stackoverflow.com/questions/20635472/using-the-run-instruction-in-a-dockerfile-with-source-does-not-work

Unable to change directories while building docker Image using Dockerfile
https://stackoverflow.com/questions/43518761/unable-to-change-directories-while-building-docker-image-using-dockerfile
说明了RUN cd之后RUN xxx can not find file的问题

Dockerfile指令详解
http://seanlook.com/2014/11/17/dockerfile-introduction/
说明RUN的两种运行模式

## nvidia-docker

### Install

<!--  -->
<br>

***

<br>
<!--  -->

# CentOS

## 使用devtoolset管理gcc版本

Ref [Blog 源代码: 安装最新版 devtoolset-8](https://lrita.github.io/2018/11/28/upgrade-newest-devtoolset/)

### Install devtoolset

Ref [Software Collections](https://www.softwarecollections.org/en/scls/?search=devtoolset&policy=&repo=&order_by=-create_date&per_page=10)

### Actiavte and deactivate devtoolset permanently

add `source scl_source enable devtoolset-7` into your `~/.bashrc` or `~/.zshrc`

Ref [StackExchange: How to permanently enable scl CentOS 6.4?](https://unix.stackexchange.com/questions/175851/how-to-permanently-enable-scl-centos-6-4)

## 安装yum

Ref [博客园: CentOS yum 源的配置与使用](https://www.cnblogs.com/mchina/archive/2013/01/04/2842275.html)

- [ ] 还没有测试过

# OpenCV画图

`cv2.rectangle`是在原图上画图，返回的也是原图

```python
img_shown = cv2.rectangle(img,
        (bbox_shown[0][0], bbox_shown[0][1]),
        (bbox_shown[1][0], bbox_shown[1][1]),
        (255, 12, 20),
        2)
if id(img_shown) == id(img):
  print('True')

>>> True
```

Ref [OpenCV doc: Drawing Functions](https://docs.opencv.org/3.2.0/d6/d6e/group__imgproc__draw.html#ga346ac30b5c74e9b5137576c9ee9e0e8c)

# aplha, beta, rc版本的区别

- alpha版: 内部测试版
- beta版: 公开测试版
- rc版: 最终发行版之前的预览版

Ref [运维生存时间: alpha、beta、rc各版本区别](http://www.ttlsa.com/linux/alpha-beta-rc/)

# 编译

## 不用gcc版本编译的库链接在一起会出问题吗

使用同一版本的编译器编译是最好的处理方式，越简单越暴力越美好。

- Ref [知乎：不同版本g++生成的库链接在一起会很大可能出错吗？](https://www.zhihu.com/question/51932153)

## 什么是ABI

Application Programming Interface.

简单的理解： ABI是在底层二进制（机器语言）的层面上做了API应该做的事情。

- Ref [stackoverflow: What is an application binary interface (ABI)?](https://stackoverflow.com/questions/2171177/what-is-an-application-binary-interface-abi)

***References:***

- [简书: 区分API和ABI？](https://www.jianshu.com/p/bd77c842f281)

## Static linking vs dynamic linking

- Dynamic: 运行时需要一部分时间消耗与内存消耗，不建议在嵌入式设备上使用

Ref [stackoverflow: Static linking vs dynamic linking](https://stackoverflow.com/questions/1993390/static-linking-vs-dynamic-linking?noredirect=1&lq=1)

# Linux

## 查看CPU信息，机器型号，内存信息等

```bash
# 环境变量
$ env
$ env | grep PATH

# 查看IP
$ ifconfig
$ hostname -I
```

## List all soft links

```bash
ls -la /var/www/ | grep "\->"
```

Ref [StackExchange: How to list all symbolic links in a directory](https://askubuntu.com/questions/522051/how-to-list-all-symbolic-links-in-a-directory)

***References:***

- [CSDN: Linux 查看CPU信息，机器型号，内存等信息](https://blog.csdn.net/bluishglc/article/details/41390589)

- [stackoverflow: How to get the primary IP address of the local machine on Linux and OS X? [closed]](https://stackoverflow.com/questions/13322485/how-to-get-the-primary-ip-address-of-the-local-machine-on-linux-and-os-x)

# 动态库

## Link-time path and Run-time path

Ref [Blog: linux动态库加载RPATH,RUNPATH](https://gotowqj.iteye.com/blog/1926771)


# Linux 防火墙配置

CentOS和Ubuntu采用不同的命令

## Centos `firewall`

```bash
firewall-cmd --permanent --zone=public --add-port=5901/tcp
firewall-cmd --reload
```

***References:***

- [Linux-command: firewall-cmd](https://wangchujiang.com/linux-command/c/firewall-cmd.html)

## Ubuntu ufw

```bash
ufw allow <port>
```

- [DigitalOcean: How To Set Up a Firewall with UFW on Ubuntu 18.04](https://www.digitalocean.com/community/tutorials/how-to-set-up-a-firewall-with-ufw-on-ubuntu-18-04)

# CentOS-7 开发机配置

- zsh
- devtool
- Python
- vim
- cmake

## zsh

```bash
yum install zsh
# Set zsh as default shell
chsh -s $(which zsh)
# Install on-my-zsh
sh -c "$(wget https://raw.githubusercontent.com/robbyrussell/oh-my-zsh/master/tools/install.sh -O -)"
# Install zsh-syntax-highlighting
cd ~/.oh-my-zsh/plugins
git clone https://github.com/zsh-users/zsh-syntax-highlighting.git ${ZSH_CUSTOM:-~/.oh-my-zsh/custom}/plugins/zsh-syntax-highlighting
```

Edit `~/.zshrc`

```bash
plugins=(
  git
  zsh-syntax-highlighting
  z)

# -----zsh
# Set *
setopt no_nomatch
# Forbiden rm -rf
alias rm='echo "rm is disabled, use trash or /bin/rm instead."'
# -----
```

***References:***

- [知乎: mac上使用oh my zsh有哪些必备的插件推荐?](https://www.zhihu.com/question/49284484/answer/617215298)

## Add yum source EPEL

```bash
yum install -y epel-release 
```

Ref [博客园: Centos 解决 No package htop available](https://www.cnblogs.com/jiqing9006/p/10030886.html)

## Development Tools

```bash
yum group install "Development Tools"
```

Ref [nixCraft: RHEL / CentOS Linux Install Core Development Tools Automake, Gcc (C/C++), Perl, Python & Debuggers](https://www.cyberciti.biz/faq/centos-linux-install-gcc-c-c-compiler/)

### Install other gcc version

```bash
yum install centos-release-scl
yum-config-manager --enable rhel-server-rhscl-7-rpms
yum install devtoolset-7
# Enable
scl enable devtoolset-7 bash
```

If you want to enable devtool as default, you need to add followings into your `~/.zshrc` or `~/.bashrc`

```
source scl_source enable devtoolset-8
```

Ref [StackExchange: How to permanently enable scl CentOS 6.4?](https://unix.stackexchange.com/questions/175851/how-to-permanently-enable-scl-centos-6-4)

## Python

1. Install **miniconda**
2. Config `~/.zshrc`

    ```bash
    export PATH=~/software/anaconda/bin:$PATH
    ```

## trash-cli

```bash
git clone https://github.com/andreafrancia/trash-cli.git
cd trash-cli
python setup.py install
```

Ref [Github andreafrancia/trash-cli](https://github.com/andreafrancia/trash-cli#from-sources)

## LLVM

Compile from source.

```bash
cmake -DCMAKE_INSTALL_PREFIX=./install  -DLLVM_ENABLE_PROJECTS="clang" -DCMAKE_BUILD_TYPE=Release ../llvm
```

Ref [LLVM doc: Getting Started with the LLVM System](https://llvm.org/docs/GettingStarted.html#requirements)

### Problem & Solutions

#### [Compile Error] `collect2: fatal error: ld terminated with signal 9 [Killed]`

You need to do one of the followings:

- Add more RAM to your VM, or
- Use gold instead of ld as a linker, or
- Build Release, not Debug build

Solution is [stackoverflow: llvm/clang compile error with Memory exhausted](https://stackoverflow.com/a/25221717)

### [Compile] Release or debug

Build llvm debug only you want to debug the compile. And when build llvm debug, it need much more memory.

Solution is [stackoverflow: Clang and LLVM - Release vs Debug builds](https://stackoverflow.com/questions/21643917/clang-and-llvm-release-vs-debug-builds)

## Change swap size

```bash
# Count=n means you want n G
$ dd if=/dev/zero of=/swapfile1 bs=1G count=1
$ chmod 600 /swapfile1
$ mkswap /swapfile1
$ swapon /swapfile1
$ vi /etc/fstab
/swapfile1  swap  swap  defaults  0 0
```

Ref [2Day Geek: 3 Easy Ways To Create Or Extend Swap Space In Linux](https://www.2daygeek.com/add-extend-increase-swap-space-memory-file-partition-linux/#)

## Delete swap file

```bash
$ swapoff -v <swap file name> # swapoff -v /swapfile
$ vim /etc/fstab
```

Ref [Redhat doc: 15.2.3. REMOVING A SWAP FILE](https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/6/html/storage_administration_guide/swap-removing-file)

## vim

### Install dependence

```bash
yum install -y ruby ruby-devel lua lua-devel luajit \
luajit-devel ctags git python python-devel \
tcl-devel \
perl perl-devel perl-ExtUtils-ParseXS \
perl-ExtUtils-XSpp perl-ExtUtils-CBuilder \
perl-ExtUtils-Embed
```

### Build (with Python3)

```bash
./configure  --with-features=huge \
             --enable-multibyte \
             --enable-rubyinterp=yes \
             --enable-pythoninterp=yes \
             --with-python-config-dir=/usr/lib/python2.7/config \
             --enable-python3interp=yes \
             --with-python3-config-dir=/root/software/anaconda/lib/python3.7/config-3.7m-x86_64-linux-gnu \
             --enable-perlinterp=yes \
             --enable-luainterp=yes \
             --enable-gui=gtk2 \
             --enable-cscope \
             --prefix=/usr/local
```

Then run `make` and `make install`.

Run `vim --version` to check if vim support Python, like `+python3`. And run followings to check if vim can run with python.

```vim
$ vim
:py3 pass
```

#### [Error] Run `:py3 pass` occur: Cannot load python3.7m.a

我是用的是Anaconda安装的Python，其python-config在`${AnacondaHome}/lib/python3.7/config-3.7m-x86_64-linux-gnu/`. 在进行`./configure`时，显示vim链接的python库为`libpython3.7m.a`（`checking Python3's dll name... libpython3.7m.a`）, 由于该库为静态库，导致vim在启动时，无法加载python的动态库，从而导致失败，也无法成功使用Youcompleteme。

解决方法为：修改执行vim的`./configure`后的`src/auto/config.mk`，让其链接对应的动态库。需要稍微注意的点是如果`${AnacondaHome}/lib/python3.7/config-3.7m-x86_64-linux-gnu/`中没有`libpython3.7m.so`，还需要将该库软连接到该目录。

```vim
PYTHON3_CFLAGS  = -I/root/software/anaconda/include/python3.7m -pthread -DDYNAMIC_PYTHON3_DLL=\"libpython3.7m.so\"
```

由于vim开启时还需要动态加载python动态库，所以还需要将`libpython3.7m.so`添加到系统库的路径中。我采用的方法是：在`/etc/ld.so.conf.d/`中创建动态库路径，之后运行`ldconfig`使其生效。

Ref [Github vim/vim: Build from source linking to Anaconda python fails #2549](https://github.com/vim/vim/issues/2549#issuecomment-358535165)

***References:***

- [stackoverflow: VIM installation and Anaconda](https://stackoverflow.com/questions/29219553/vim-installation-and-anaconda)

### Config

Edit `~/.vimrc`

```vim
set nocompatible              " be iMproved, required
filetype off                  " required
set nu!
syntax on
set ts=4
set backspace=2
set expandtab

set encoding=utf-8  " The encoding displayed.
set fileencoding=utf-8  " The encoding written to file.
```

### Plugin

```bash
mkdir -p ~/.vim/bundle
cd ~/.vim/bundle
git clone <plugin>
# Follow plugin git readme to build and install
# ...
```

Ref [howchoo.com: How to install Vim plugins without a plugin manager](https://howchoo.com/g/ztmyntqzntm/how-to-install-vim-plugins-without-a-plugin-manager)

#### Using vim-pathogen to manage runtimepath to load plugin

Ref [Github: tpope/vim-pathogen](https://github.com/tpope/vim-pathogen)

```bash
mkdir -p ~/.vim/autoload ~/.vim/bundle && \
curl -LSso ~/.vim/autoload/pathogen.vim https://tpo.pe/pathogen.vim
```

Add followings into `.vimrc`

```vim
execute pathogen#infect()
```

#### Plugin needed:

- [YouCompleteMe](https://github.com/Valloric/YouCompleteMe)

  ```bash
  python setup.py --clang-completer --system-libclang
  ```

  ***References:***

  - [Github Valloric/YouCompleteMe: CMake Error at ycm/CMakeLists file DOWNLOAD HASH mismatch #1711](https://github.com/Valloric/YouCompleteMe/issues/1711#issuecomment-329520570)

# Python to so

[Python doc](https://docs.python.org/zh-cn/3/distributing/index.html#create-and-distribute-binary-extensions)

  ***References:***

  - [Jan Buchar Blog: Using Cython to protect a Python codebase](https://bucharjan.cz/blog/using-cython-to-protect-a-python-codebase.html)
  
  - [CSDN: python文件编译成so介绍 - 1.使用cython将py文件编译成so文件](https://blog.csdn.net/linshenyuan1213/article/details/72677246)

# Wrap C to Python

***References:***

- [Medium: Making your C library callable from Python by wrapping it with Cython](https://medium.com/@shamir.stav_83310/making-your-c-library-callable-from-python-by-wrapping-it-with-cython-b09db35012a3)

# 如何理解Numpy中的axis和PyTorch中的dim

axis和dim的含义基本一致

**我的理解:**

可以把axis、dim看作为坐标轴(增长的方向，正方向);操作于某一个axis上，可以理解为该操作贯穿于该坐标轴。dim的另一个含义是：张量的维度

对于(H, W)的矩阵
axis=0表示行增长的方向，axis=1表示列增长的方向

```python
a = np.random.randn(5, 4)
np.min(a, axis=0).shape
>>> (4,)
np.min(a, axis=1).shape
>>> (5,)
```

***References:***

- [Blog: 如何理解Pandas 和 Numpy里的axis](http://frankchen.xyz/2017/12/12/Understanding-the-axis-parameter-in-Pandas-and-Numpy/)

# Python Package

- setuptools
- setup.py

```bash
example/
    utils/
        __init__.py
        common_utils.py
    setup.py
```

`setup.py` is

```python
from setuptools import setup, find_packages

setup(name='funniest',
      version='0.1',
      description='The setup example',
      url='None',
      author='rivergold',
      author_email='rivergold@126.com',
      license='MIT',
      packages=find_packages())
```

Then you can run `pip install .` to install this package.

Ref [python-packaging Docs](https://python-packaging.readthedocs.io/en/latest/minimal.html).

Run `python setup.py --help-commands` to get all commands.

Ref [An example pypi project: Getting Started With setuptools and setup.py](https://pythonhosted.org/an_example_pypi_project/setuptools.html#getting-started-with-setuptools-and-setup-py)

## Compile `.py` into `.so`

- The `cython` command taks a `.py` or `.pyx` file and compiles it into a C/C++ file.

- The `cythonize` command takes a `.py` or `.pyx` file and compiles it into a C/C++ file. It then compiles the C/C++ file into an extension module which is directly importable from Python.

Ref [Cython doc: Source Files and Compilation](https://cython.readthedocs.io/en/latest/src/userguide/source_files_and_compilation.html#compiling-from-the-command-line)

# PIL, Wand, Numpy

***References:***

- [stackoverflow: How to convert wand image object to open cv image (numpy array)](https://stackoverflow.com/questions/37015966/how-to-convert-wand-image-object-to-open-cv-image-numpy-array?rq=1)
- [stackoverflow: How to convert a wand image object to numpy array (without OpenCV)?](https://stackoverflow.com/questions/47599012/how-to-convert-a-wand-image-object-to-numpy-array-without-opencv)

Wand to PIL

```python
import PIL
img = PIL.Image.open(image_path.as_posix())
output_buffer = BytesIO()
img.save(output_buffer, format='PNG')
byte_data = output_buffer.getvalue()
with wand.image.Image(blob=byte_data) as img:
    print(img.width)
    display(img)
```

Ref [简书: PIL.Image与Base64 String的互相转换](https://www.jianshu.com/p/2ff8e6f98257)

# OpenCV 仿射变换

OpenCV中的`cv.getAffineTransform(srcTri, dstTri)`可以计算出变换矩阵，使用`cv.warpAffine(src, warp_mat, (src.shape[1], src.shape[0]))`进行仿射变换。
后面两个参数为输出图片的大小。
可以自己计算变换矩阵，之后进行变换。

# Python ElementTree parse xml

## findall tag recurively

Method 1: Using generator

```python
def find_rec(node, element, result):
    for item in node.findall(element):
        result.append(item)
        find_rec(item, element, result)
    return result
```

Method 2: Using `.iter(tag)`

```python
for i in data.iter('node'): 
  print(i.attrib['name'])
```

Ref [stackoverflow: ElementTree - findall to recursively select all child elements](https://stackoverflow.com/questions/30097949/elementtree-findall-to-recursively-select-all-child-elements)

# Python Class Copy

```python
@property
def bbox(self):
    return self._bbo
@bbox.setter
def bbox(self, bbox_data):
    if isinstance(bbox_data, str):
        bbox_data = ast.literal_eval(bbox_data)
        self._bbox = BBox(*bbox_data)
    elif isinstance(bbox_data, BBox):
        print('debug')
        print(id(bbox_data))
        self._bbox = bbox_data
        # self._bbox = copy.deepcopy(bbox_data)
        print(id(self.bbox))
    elif isinstance(bbox_data, tuple):
        self.bbox = BBox(*bbox_data)
```

# CentOS Python opencv occur error `ImportError: libSM.so.6: cannot open shared object file: No such file or directory`

```bash
# yum install libXext.x86_64
# yum install libXrender-0.9.8-2.1.el7.x86_64
# yum install libXext.x86_64
yum install libSM.x86_64 0:1.2.2-2.el7
```

```bash
yum whatprovides libSM
```

Ref [CSDN: python中import cv2遇到的错误及安装方法](https://blog.csdn.net/a1368783069/article/details/80254257)

***References:***

- [stackoverflow: How do I find which rpm package supplies a file I'm looking for?](https://stackoverflow.com/questions/1133495/how-do-i-find-which-rpm-package-supplies-a-file-im-looking-for)

# [Python] Use `{` in `format`

```python
print('{{Test: {}}}'.format('ok'))
```

Ref [BFH: python字符串中包含大括号时怎么使用sting的.format方法？](https://www.bufeihua.cn/p/57373c42b98b3512bf9fd042)

# pip 安装指定安装源

```bash
pip install <package> -i <pip_source>
```

Ref [CSDN: 临时指定pip源路径，无需配置pip源](https://blog.csdn.net/daijiguo/article/details/78085603)

# Python logging into different files

Set handler with different file name.

Ref [Python doc: logging.handlers — Logging handlers](https://docs.python.org/3/library/logging.handlers.html#filehandler)

It's a good to set Python logging with a `default_logging_config.json`

# Python `zip` a folder

```python
import shutil
shutil.make_archive(output_filename, 'zip', dir_name)
```

Ref [stackoverflow: How to create a zip archive of a directory](https://stackoverflow.com/a/25650295/4636081)