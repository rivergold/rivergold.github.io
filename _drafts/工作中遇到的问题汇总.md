# Python

## numpy数据转化

```python
a = np.zeros((2, 2), np.uint8)
a[0, 0] = 300.11
print(a)
>>> array([[44,  0],
       [ 0,  0]], dtype=uint8)
```

```python
a[0, 0] = 256
print(a)
>>> array([[0, 0],
       [0, 0]], dtype=uint8)
```

**请注意这一点**

如果np.ndarray中的数据大于255，需要转化为整数时，请使用`astype(np.int32)`或者`astype(np.uint32)`。请注意位数，如果使用`astype(np.uint8)`则会出现数据溢出！


## OpenCV build with Cuda

## Numpy `copy` and `view`

***References:***

- [Blog: Numpy Views vs Copies: Avoiding Costly Mistakes](http://www.jessicayung.com/numpy-views-vs-copies-avoiding-costly-mistakes/)

## Path.glob

Path.glob('*') 不会包含`.` `..`

## Python字符串包含双引号

Ref [CSDN: Python中，怎么在字符串里嵌入双引号或者单引号](https://blog.csdn.net/linshenwei1995/article/details/78987444)

## python -m `` 的问题

RuntimeWarning: 'dataset.reg_dataset' found in sys.modules after import of package 'dataset', but prior to execution of 'dataset.reg_dataset'; this may result in unpredictable behaviour
  warn(RuntimeWarning(msg))

自己总结的经验：
- 如果想要执行package中的module，使用`python -m <pakcage name>.<module_name>`：
   - 请不要在package中的__init__.py中import这个module，否则该module会被执行两遍：第一次实在import这个package时，第二次是你的执行package.module时，这是还会出现`RuntimeWarning: 'dataset.reg_dataset' found in sys.modules after import of package 'dataset', but prior to execution of 'dataset.reg_dataset'; this may result in unpredictable behaviour
  warn(RuntimeWarning(msg))`的warning

Ref [Medium: Python 的 Import 陷阱](https://medium.com/pyladies-taiwan/python-%E7%9A%84-import-%E9%99%B7%E9%98%B1-3538e74f57e3)


### Script 与 module的区别

本质上没有区别，只是script会有`__name__ == '__main__'`，而module一般是被别的文件import的

Ref [stackoverflow: What is the difference between a module and a script in Python?](https://stackoverflow.com/questions/2996110/what-is-the-difference-between-a-module-and-a-script-in-python)

# shell

## bash与sh区别

`test.sh`:

```shell
#!/bin/sh

a=10
b=20

if [ $a == $b ]
then
   echo "a is equal to b"
else
   echo "a is not equal to b"
fi
```

When run `sh test.sh`, occur `run.sh: 6: [: 10: unexpected operator`

`sh` not support `==`

Ref [stackoverflow: [:Unexpected operator in shell programming [duplicate]](https://stackoverflow.com/a/3411105/4636081)

`#!/bin/bash` will work when run `./test.sh`

<!--  -->
<br>

***

<br>
<!--  -->

# Android开发

## `Build APKS`操作可以实现对动态库进行“抽取”

原本编译出来的libtensorflowlite有50多MB，进行build apks生成的apk中包含的动态库只有几百k。

单独使用CMake，脱离android studio编译出来的库也可以通过build apks实现动态库的抽取

<!--  -->
<br>

***

<br>
<!--  -->

# 变量命名
- 对于带修饰词的变量，i.e `img_scaled`， 将修饰词放置后面
- 一般变量，使用组合名词表示

# Other

编写visualier时，需要将tensor转化为numpy，出现error
```
Traceback (most recent call last):
  File "train.py", line 121, in <module>
    train(opt)
  File "train.py", line 107, in train
    visualizer.plot_images(x, y_hat)
  File "src/utils/visualizer.py", line 105, in plot_images
    kps = tensor2kps(kps_tensor[s_id])
  File "src/utils/utils.py", line 67, in tensor2kps
    kps = kps.numpy().reshape(-1, 2)
RuntimeError: Can't call numpy() on Variable that requires grad. Use var.detach().numpy() instead.
```

`detach` do what:

Ref [CSDN: pytorch: Variable detach 与 detach_](https://blog.csdn.net/u012436149/article/details/76714349): 该链接所写的，值得研究！

- [PyTorch doc: `torch.Tensor`](https://pytorch.org/docs/stable/autograd.html#torch.Tensor.detach)

<br>

***

<br>

## git ignore file by path

我的repo里面有两个名叫dataset的文件夹，我想忽略根目录下的。如果在`.gitignore`写`dataset/`会将两个都忽略，需要改写为`/dataset/`来根据路径进行忽略

ref [segmentfault: .gitignore 如何仅忽略根目录下的index.html](https://segmentfault.com/q/1010000004064190)

## 3D模型基本概念

- [Unity doc: Materials, Shaders & Textures](https://docs.unity3d.com/Manual/Shaders.html)

- [AUTODESK MAYA 2017 帮助](http://help.autodesk.com/view/MAYAUL/2017/CHS/?guid=GUID-FDCD0C68-2496-4405-A785-3AA93E9A3B25)

### UV

Ref [博客园: 理解UV贴图](https://www.cnblogs.com/jiahuafu/p/6831330.html)

## 3D人脸重建

参数化3D人脸模型：人脸参数、blendshape参数
2D图像人脸关键点检测 -> 3D模型投影（需要计算相机参数）-> 误差计算

<br>

***

<br>

# Python提升GPU利用率

## 减少花费在CPU上的数据预处理时间
  
### 使用多核CPU处理

Python get cpu count:

- `os.cpu_count()`
- `multiprocessing.cpu_count()`

Ref [stackoverflow: How to find out the number of CPUs using python](https://stackoverflow.com/a/25636145/4636081)

给PyTorch中的Dataloader设置`num_workers`

Ref [PyTorch Forum: How to speed up the data loader](https://discuss.pytorch.org/t/how-to-speed-up-the-data-loader/13740/6?u=rivergold)

## 使用HDF5存储训练数据

Ref [PyTorch Forum: How to speed up the data loader](https://discuss.pytorch.org/t/how-to-speed-up-the-data-loader/13740/3?u=rivergold)

- [ ] 有待调研

## 有用的资料

- [Medium: Speed Up your Algorithms Part 1 — PyTorch](https://towardsdatascience.com/speed-up-your-algorithms-part-1-pytorch-56d8a4ae7051)
- [SAGIVTECH: Optimizing PyTorch training code](https://www.sagivtech.com/2017/09/19/optimizing-pytorch-training-code/)v