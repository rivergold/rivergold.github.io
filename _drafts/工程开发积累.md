# :fallen_leaf:Database

- DBaaS: 数据库即服务

  **_Ref:_** [Oracle: 数据库即服务 (DBaaS) 概述](https://www.oracle.com/technetwork/cn/community/developer-day/2-dbaas-outline-1864781-zhs.pdf)

## NoSQL & SQL

**_References:_**

- [51CTO: 阿里 P8 架构师谈：NoSQL 和 SQL 的区别，NoSQL 的使用场景和选型比较](http://database.51cto.com/art/201808/582267.htm)

<!--  -->
<br>

---

<br>
<!--  -->

# :fallen_leaf:MongoDB

## Install

**Ubuntu**

1. Edit `/etc/apt/sources.list.d` with followings

```bash
echo "deb [ arch=amd64 ] https://repo.mongodb.org/apt/ubuntu bionic/mongodb-org/4.0 multiverse" | sudo tee /etc/apt/sources.list.d/mongodb-org-4.0.list
```

2. Update apt

```bash
sudo apt update
```

3. Install

```bash
sudo apt-get install -y mongodb-org
```

**_Ref:_** [MongoDB doc: Install MongoDB Community Edition on Ubuntu](https://docs.mongodb.com/manual/tutorial/install-mongodb-on-ubuntu/)

**CentOS**

1. Create `/etc/yum.repos.d/mongodb-org-4.0.repo`

   ```bash
   [mongodb-org-4.0]
   name=MongoDB Repository
   baseurl=https://repo.mongodb.org/yum/redhat/$releasever/mongodb-org/4.0/x86_64/
   gpgcheck=1
   enabled=1
   gpgkey=https://www.mongodb.org/static/pgp/server-4.0.asc
   ```

2. `sudo yum install -y mongodb-org`

**_Ref:_** [Mongodb doc: Install MongoDB Community Edition on Red Hat Enterprise or CentOS Linux](https://docs.mongodb.com/manual/tutorial/install-mongodb-on-red-hat/)

<!--  -->
<br>

---

<!--  -->

## mongo

### Config

```bash
net:
  port: 27017
  bindIp: 127.0.0.1, <your_computer_ip>

security:
  authorization: enabled
```

### Firewall allow

**Ubuntu `ufw`**

```bash
# Specify the ip that can access to MongoDB
sudo ufw allow <from ip> to any port 27017
# Allow any ip can access to MongoDB
sudo ufw allow 27017
```

**_Ref:_** [HowtoForge: How to Install and Configure MongoDB on Ubuntu 18.04 LTS](https://www.howtoforge.com/tutorial/install-mongodb-on-ubuntu/)

### Create user

```bash
db.createUser(
  {
    user: "admin",
    pwd: "123",
    roles: [ { role: "userAdminAnyDatabase", db: "admin" } ]
  }
)
```

**_Ref:_** [简书: MongoDB 的用户创建更新及删除](https://www.jianshu.com/p/f5afc6488f9e)

### `use <databasename>`

### `show dbs`

### `show users`

<!--  -->
<br>

---

<!--  -->

## PyMongo

### Insert

### Update and insert when not occur

```python
collection.update_one(
    {'you key to check exist or not': value},
    {
        '$set': dict((k, dict_data) for k in ['keys'], upsert=True)
    }
)
```

### Delete collection

```py
db.drop_collection(<collection_name>)
```

**_Ref:_** [stackoverflow: How to drop a collection with pymongo?](https://stackoverflow.com/questions/48923682/how-to-drop-a-collection-with-pymongo)

### Delete database

```python
client.drop_database(<database name>)
```

**_Ref:_** [stackoverflow: How do I drop a MongoDB database using PyMongo?](https://stackoverflow.com/questions/35463526/how-do-i-drop-a-mongodb-database-using-pymongo)
