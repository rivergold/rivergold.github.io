# Good Tutorials

- [Pro Git 中文版](https://bingohuang.gitbooks.io/progit2/content/)
- [GitHub 漫游指南](http://github.phodal.com/)

**_References:_**

- [知乎: 一些关于 Git 的学习资源](https://zhuanlan.zhihu.com/p/32379998?utm_source=ZHShareTargetIDMore&utm_medium=social&utm_oi=37839882420224)
- [知乎: 如何在 GitHub 上做一个优秀的贡献者？](https://www.zhihu.com/question/310488111/answer/585336948?utm_source=ZHShareTargetIDMore&utm_medium=social&utm_oi=37839882420224)

# :fallen_leaf:Concept

## Git workflow

- `working tree`:
- `index`: a **staging area** between your working directory and your repository.
- `repository`: or repo

<p align="center">
  <img
  src="https://upload-images.jianshu.io/upload_images/9890707-d806fc0dc4bc8a75.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" width="80%">
</p>

<p align="center">
  <img
  src="https://upload-images.jianshu.io/upload_images/9890707-c32ab2866b185bdc.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240"
  width="70%">
</p>

**_References:_**

- [backlog: Git workflow](https://backlog.com/git-tutorial/git-workflow/)

<!--  -->
<br>

---

<!--  -->

## Changelog

**_Ref:_** [Github olivierlacan/keep-a-changelog](https://github.com/olivierlacan/keep-a-changelog/blob/master/CHANGELOG.md)

---

## Licenses

**_References:_**

- [Github: phodal/licenses](https://github.com/phodal/licenses)

---

## WIP

On GitHub, pull requests are prefixed by [WIP] to indicate that the pull requestor

- has not yet finished his work on the code (thus, work in progress), but
- looks for have some initial feedback (early-pull strategy), and
- wants to use the continuous integration infrastructure of the project. For instance, TravisCI, CodeCov, and codacy.

**_Ref:_**

- [stackoverflow: GitHub: What is a “wip” branch?](https://stackoverflow.com/questions/15763059/github-what-is-a-wip-branch)

<!--  -->
<br>

---

<br>
<!--  -->

# :fallen_leaf:Basic

## Generate keys

```bash
ssh-keygen -t rsa -b 4096 -C "your_email@example.com"
```

## Local

### `git status`

- `Untracked files`: New add file and not be untracked

- `Changes to be committed`: After use `git add <file>`, the file is tracked and staged

- `Changes not staged for commit`: Tracked file is changed, but not staged. Use `git add` to stage.

### `git add <file>`

Track new file or modified file, and stage file.

### `git commit -m <message>`

Commit staged file into `Repository`.

### `git submodule add <git https/ssh> <folder name>`

**_References:_**

- [简书: Git submodule 子模块的管理和使用](https://www.jianshu.com/p/9000cd49822c)

### `git reset [--hard|--soft|--mix]`

**_References:_**

- [stackoverflow: What's the difference between git reset --mixed, --soft, and --hard?](https://stackoverflow.com/questions/3528245/whats-the-difference-between-git-reset-mixed-soft-and-hard)
- [git 7.7 Git 工具 - 重置揭密](https://git-scm.com/book/zh/v2/Git-%E5%B7%A5%E5%85%B7-%E9%87%8D%E7%BD%AE%E6%8F%AD%E5%AF%86)

### `git branch -a`

Show all branch

### `git branch -d <branch name>`

Delete branch

### Create new branch from current branch

```shell
git checkout -b <new_branch_name>
```

### `git clean [-d] [-f] [-i] [-n] [-q] [-e <pattern>] [-x | -X] [--] <path>`

Cleans the working tree by recursively removing files that are not under version control, starting from the current directory.

- `-d`: Remove untracked directories in addition to untracked files.
- `-f`: `--force`
- `-x`: Don’t use the standard ignore rules, means will also clean files in `.gitignore`

E.g.

```shell
# Clean without file in `.gitignore`
git clean -df
# Clean with file in `.gitignore`
git clean -xdf
```

**_References:_**

- [stackoverflow: How do I discard unstaged changes in Git?](https://stackoverflow.com/a/12184274/4636081)

<!--  -->
<br>

---

<!--  -->

## Remote

### From remote

#### Checkout from remote branch

```shell
git checkout -b <local_branch_name> <remote_name>/<branch_name>
# Shorthand
git checkout -t <remote_name>/<branch_name>
```

**_Ref:_** [stackoverflow: How do I check out a remote Git branch?](https://stackoverflow.com/a/1783426/4636081)

#### `git fetch [remote-name]`

Only Get files from remote to your repository. It will not change anythings.

#### `git pull`

Get files from remote and merge into current branch.

#### `git clone --recurese-submodules <git https/ssh>`

Clone with submodule from remote.

For already cloned repos, or older Git versions, use:

```bash
git clone git://github.com/foo/bar.git
cd bar
git submodule update --init --recursive
```

**_References:_**

- [stackoverflow: How to git clone including submodules?](https://stackoverflow.com/questions/3796927/how-to-git-clone-including-submodules)

<!--  -->
<br>

---

<!--  -->

## To remote

<!--  -->
<br>

---

<!--  -->

## Submodule

### Check submodule

```bash
git submodule
```

### Clone with submodule

```bash
git clone --recursive <remote url>
```

**_Ref:_** [git: 7.11 Git 工具 - 子模块](https://git-scm.com/book/zh/v2/Git-%E5%B7%A5%E5%85%B7-%E5%AD%90%E6%A8%A1%E5%9D%97)

### Add submodule

```bash
git submodule add <ssh_url> <path>
```

### Delete submodule

```bash
git submodule deinit <path_to_submodule>
git rm <path_to_submodule>
git commmit -m "Remove submodule"
rm -rf .git/modules/<path_to_submodule>
```

**_Ref:_** [Github Gist: myusuf3/delete_git_submodule.md](https://gist.github.com/myusuf3/7f645819ded92bda6677)

### Update submodule with remote

```bash
git submodule update --remote
```

**_References:_**

- [简书: Git submodule 子模块的管理和使用](https://www.jianshu.com/p/9000cd49822c)

<!--  -->
<br>

---

<br>
<!--  -->

# :fallen_leaf:gitignore

- [Bitbucket Tutorials: .gitignore](https://www.atlassian.com/git/tutorials/saving-changes/gitignore)

## Ignore filename contain parttern

```git
**.vscode** # 忽略所有文件名中包含`.vscode`的文件
```

**_Ref:_** [stackoverflow: git ignore filenames which contain <pattern to ignore>](https://stackoverflow.com/a/32335752/4636081)

<!--  -->
<br>

---

<br>
<!--  -->

# :fallen_leaf:Tricks

## Download a single file from Github

**_References:_**

- [stackoverflow: Download single files from GitHub](https://stackoverflow.com/questions/4604663/download-single-files-from-github)

---

## Merge

- [segmentfault: 理解 git 结构与简单操作（四）合并分支的方法与策略](https://segmentfault.com/a/1190000013753251)

---

## Download a single folder or directory from a Github repo

**_References:_**

- [stackoverflow: Download a single folder or directory from a GitHub repo](https://stackoverflow.com/questions/7106012/download-a-single-folder-or-directory-from-a-github-repo)

---

## Rebase vs Merge

rebase: `rebase <from> onto <to>`

You can get complete introduction from [Git: 6 Git 分支 - 分支的衍合][git 6 分支 - 分支的衍合].

And there is a [video][gitkraken rebase vide] tell your how to use rebase in Gitkraken.

[gitkraken rebase vide]: https://www.youtube.com/watch?v=nAMbLbgxriI
[git 6 分支 - 分支的衍合]: https://git-scm.com/book/zh-tw/v1/Git-%E5%88%86%E6%94%AF-%E5%88%86%E6%94%AF%E7%9A%84%E8%A1%8D%E5%90%88

**Important: 不要给公共的 branch 换基**

例如：绝对不能将 master 换基到别的分支上，但是可以将别的分支换基到 master 上。

**_References:_**

- [Bitbucket: Merging vs. Rebasing](https://www.atlassian.com/git/tutorials/merging-vs-rebasing)

---

## Code Review

**_References:_**

- [Blog: 基于 GitLab 的 Code Review 教程](https://ken.io/note/gitlab-code-review-tutorial)

---

## How to use Watch, Star and Fork

- Watch: 关注这个项目的动态
- Star: 对这个项目点赞
- Fork: 相当于你自己有了一份原项目的拷贝，当然这个拷贝只是针对当时的项目文件，如果后续原项目文件发生改变，你必须通过其他的方式去同步

Ref [简书: 如何用好 github 中的 watch、star、fork](https://www.jianshu.com/p/6c366b53ea41)

---

## Merge two repos

Assum you want to merge `repo1` into `repo2`

1. Add `repo1` into `repo2` remote

   ```bash
   git remote add <remote name> <repo1 ssh>
   ```

2. Checkout repo1 to local

   ```bash
   git branch -a
   git checkout -b repo1 <remote name>/<branch name>
   ```

3. Merge repo1 into repot-master

   ```bash
   git checkout master
   git merge repo1
   ```

   If occur error `fatal: refusing to merge unrelated histories`

   Run:

   ```bash
   git merge repo1 --allow-unrelated-histories
   ```

   **_References:_** [CSDN: 解决 Git 中 fatal: refusing to merge unrelated histories](https://blog.csdn.net/wd2014610/article/details/80854807)

**_References:_** [CSDN: 合并两个 git 仓库](https://blog.csdn.net/gouboft/article/details/8450696)

---

## Keep gitignore file when switch branch

If your file is tracked before, and you want to ignore it.

```bash
git rm --cached file_path
```

**_Ref:_** [VoidCC: GIT：切换分支时如何保留忽略的文件？](http://cn.voidcc.com/question/p-volmanrm-hr.html)

**_References:_**

- [简书: git rm 与 git rm --cached](https://www.jianshu.com/p/337aeafc2f40)

---

## Clone a specific tag

```shell
git clone <git ssh>
git checkout tags/<tag_name> -b <new_branch_name>
```

**_Ref:_** [stackoverflow: Download a specific tag with Git](https://stackoverflow.com/questions/791959/download-a-specific-tag-with-git)

---

## Fetch a specific tag

```shell
git fetch [remote] <tag_name>
```

E.g.

```shell
git fetch pytorch v1.3.0
```

**_References:_**

- [stackoverflow: Fetch a single tag from remote repository](https://stackoverflow.com/questions/45338495/fetch-a-single-tag-from-remote-repository)

---

## Checkout into a specific tag

```shell
git checkout <tag_name>
```

**_References:_**

- [CSDN: git 切换到某个 tag](https://blog.csdn.net/DinnerHowe/article/details/79082769)

---

## Checkout new branch from a specific tag

```shell
git checkout -b <branch_name> <tag_name>
```

---

## Pull from a local branch

When finish Gitlab or Github merge request / pull request, because of Gitlab or Github use `git merge` with `--no-ff`, `HEAD` of `dev` will fall behind `HEAD` of `master`. You need to do followings to fast-forward `HEAD` of `dev` to `master`.

```shell
git checkout master
git pull
git checkout dev
git pull . master
```

- `.`: means from local not remote

- `git pull . master`: means pull from `local:master` into current `dev`

**_References:_**

- [stackoverflow: How to “pull” from a local branch into another one?](https://stackoverflow.com/questions/5613902/how-to-pull-from-a-local-branch-into-another-one)

- [Samuel Gruetter Blog Git: Fast-forwarding a branch without checking it out](https://samuelgruetter.net/blog/2018/08/31/git-ffwd-without-checkout/)

- [ariya.io: Fast-Forward Git Merge](https://ariya.io/2013/09/fast-forward-git-merge)

---

## Fork and Keep update

1. `git remote add <forked_upstream_name> <forked_upstream_url>`

2. `git checkout master`

3. `git fetch <forked_upstream_name>`

4. `git merge <forked_upstream_name>/master`

E.g.

```shell
# After fork pytorch/pytorch
git remote add pytorch https://github.com/pytorch/pytorch.git
git checkout master
git fetch pytorch
git merge pytorch/master
```

- [简书: 如何解决 github fork 之后 更新问题](https://www.jianshu.com/p/840ea273f25a)

---

## Pull Request

**_References:_**

- :thumbsup:[CSDN: Github 使用之 Pull Request 的正确打开方式（如何在 GitHub 上贡献开源项目）](https://blog.csdn.net/yxys01/article/details/78316649)
- :thumbsup:[知乎: GitHub Pull Request 入门](https://zhuanlan.zhihu.com/p/51199833)

---

## List remote tags

```shell
git ls-remote --tag [remote_name]
# Example-1
git ls-remote --tag
# Example-2
git ls-remote --tag pytorch
```

**_References:_**

- [stackoverflow: How to see remote tags?](https://stackoverflow.com/questions/25984310/how-to-see-remote-tags)

<!--  -->
<br>

---

<br>
<!--  -->

# gitignore

- :thumbsup:[Bitbucket: .gitignore](https://www.atlassian.com/git/tutorials/saving-changes/gitignore)

## :triangular_flag_on_post:Ignore a folder without a specific file

```git
# OK
/test/*
!/test/README.txt
# Failed
/test/
!/test/README.txt
```

<!--  -->
<br>

---

<br>
<!--  -->

# :fallen_leaf:Problems & Solutions

## `origin/dev` and `origin/master` is not at the same header

When you change `dev` and want to merge `dev` into `master`, you will do:

1. On `dev`, make a commit
2. check out into `master`
3. merge `dev` into `master`
4. push `master` to `origin/master`

After these operations, you will find that content of `dev` and `master` are same, but the `dev` is behind one commit of `master`. Your need to run followings additionally:

1. Checkout to `dev`
2. Fast-forward `dev` into `master`
3. Push `dev` into `origin/dev`

<!--  -->
<br>

---

<br>
<!--  -->

# :fallen_leaf:Tools

## [Lepton][lepton_home]

[lepton_home]: https://github.com/hackjutsu/Lepton

A good code snippet manager based on Github Gist.

**_References:_**

- [What is the best code-snippets manager?](https://www.slant.co/topics/7247/~code-snippets-manager#10)

---

## meld

Ref [Linux 中国: 给中级 Meld 用户的有用技巧](https://linux.cn/article-8808-1.html)

### Config

```bash
[user]
    email = hejing01@qiyi.com
    name = Jing He
[core]
    autocrlf = input
[diff]
    tool = meld
[difftool]
    prompt = false
[difftool "meld"]
    cmd = /usr/bin/meld "$LOCAL" "$REMOTE"
[merge]
    tool = meld
[mergetool "meld"]
    cmd = /usr/bin/meld "$REMOTE" "$MERGED" "$LOCAL" --output "$MERGED"
```

**Note: I like current file into right hand window.**

Ref [stackoverflow: Setting up and using Meld as your git difftool and mergetool](https://stackoverflow.com/a/34119867/4636081)

### Run `git difftool`

`$LOCAL`: pre-image (旧的)
`$REMOTE`: post-image (新的)

Ref [git docs](https://git-scm.com/docs/git-config#Documentation/git-config.txt-difftoollttoolgtcmd)

### Run `git mergetool`

Suppose current in `branch-a`, merge `branch-b` into `a`.

`b ($REMOTE) -> a($LOCAL)`

### [Problem] meld not work on Python 3.7

Edit `~/.gitconfig`:

```git
[diff]
    tool = meld
[difftool]
    prompt = false
[difftool "meld"]
    cmd = "alias python=/usr/bin/python && alias python3=/usr/bin/python3.6 && /home/  rivergold/software/common/meld-3.20.1/bin/meld" "$LOCAL" "$REMOTE"
[merge]
    tool = meld
[mergetool "meld"]
    cmd = "alias python=/usr/bin/python && alias python3=/usr/bin/python3.6 && /home/  rivergold/software/common/meld-3.20.1/bin/meld"  "$REMOTE"  "$MERGED" "$LOCAL" --      output "$MERGED"
```

---

## gitignore.io

- [gitignore.io](https://gitignore.io/)

Many gitignore template.

**_Ref:_** [码农有道: 用好这几个工具，能大幅提升你的 Git/GitHub 操作效率！](https://mp.weixin.qq.com/s?__biz=MzIwNTc4NTEwOQ==&mid=2247487007&idx=1&sn=8b036cef813799bd9fa3728cfb4b6552&chksm=972adf65a05d567330f5f6480c9a3f6466a45898b4d5dad41e0a0f2259ccc6c8ae3330ced3f2&mpshare=1&scene=1&srcid=#rd)

## readme-md-generator

- [Github](https://github.com/kefranabg/readme-md-generator)

<!--  -->
<br>

---

<br>
<!--  -->

# tig

- In `view-status`: `e`: edit file

## Base Command

### Create new branch

Edit `~/.tigrc`, add followings:

```shell
bind branch n !@git branch %(prompt)
bind branch d !?@git branch -d %(branch)
```

In `view-refs`: `n`

**_References:_**

- [Github - jonas/tig: Create new branch command #88](https://github.com/jonas/tig/issues/88)

---

### Checkout into branch

In `view-refs`: `C`

---

### Edit file

In `view-status`: `e`

---

### Config `vim` as default git editor

```shell
git config --global core.editor "vim"
```

**_References:_**

- [How do I make Git use the editor of my choice for commits?](https://stackoverflow.com/a/2596835/4636081)

---

## tigrc

Config example is in [Github jonas/tig: tigrc](https://github.com/jonas/tig/blob/master/tigrc)

<!--  -->
<br>

---

<br>
<!--  -->

# git submodule

- [git doc: 7.11 Git 工具 - 子模块](https://git-scm.com/book/zh/v2/Git-%E5%B7%A5%E5%85%B7-%E5%AD%90%E6%A8%A1%E5%9D%97)

## 理解

- main repo
- submodule

<!-- ## When checkout branch in main repo, must run followings to update submodule

```
``` -->

## Update submodule to the latest commit with origin

```shell
git submodule sync
git submodule update --init --recursive # 和submodule的repo的origin同步
# git submodule update --remote
# Update specific submodule
git submodule update --init --recursive <specific path to submodule>
```

**_References:_**

- [stackoverflow: Update Git submodule to latest commit on origin](https://stackoverflow.com/questions/5828324/update-git-submodule-to-latest-commit-on-origin)
- [stackoverflow: How to only update specific git submodules?](https://stackoverflow.com/questions/16728866/how-to-only-update-specific-git-submodules)

---

## Reset submodule

```shell
# In main repo
git reset --hard
# Update submodule
git submodule update --recursive
```

**_References:_**

- [stackoverflow: How to revert a Git Submodule pointer to the commit stored in the containing repository?](https://stackoverflow.com/a/43303392/4636081)

---

## Remove submodule

```shell
# Remove the submodule entry from .git/config
git submodule deinit -f path/to/submodule

# Remove the submodule directory from the superproject's .git/modules directory
rm -rf .git/modules/path/to/submodule

# Remove the entry in .gitmodules and remove the submodule directory located at path/to/submodule
git rm -f path/to/submodule
```

**_References:_**

- [stackoverflow: How do I remove a submodule?](https://stackoverflow.com/a/21211232/4636081)

---

## 经验总结

- 使用`git submodule update --recursive`代替`git submodule update`
- `git submodule update`会更新 submodule 到该仓库的最新的 commit，但是最细你的 commit 可能不支持现有的 main repo，所以可能需要把 submodule `git reset`到某个版本

<!--  -->
<br>

---

<br>
<!--  -->

# git config

## username and email

- [Github Help: Setting your username in Git](https://help.github.com/en/github/using-git/setting-your-username-in-git)

**Print current username and email**

```shell
git config user.name
git config user.email
```

**_References:_**

- [Blog: How to show or change your Git username or email address](https://alvinalexander.com/git/git-show-change-username-email-address)

### Global

TODO:

### Single Repo

```shell
# username
git config user.name "<your name>"
# email
git config user.email "<your email>"
```

<!--  -->
<br>

---

<br>
<!--  -->

# git reset

**_References:_**

- [CSDN: git reset 版本回退](https://blog.csdn.net/ezhchai/article/details/79387369)

<!--  -->
<br>

---

<br>
<!--  -->

# git rm

## Untrack tracked file

Assume you have commit your .vscode, and now you don't want to track it anymore.

```shell
git rm -r --cached .vscode
```

**_References:_**

- [stackoverflow: Untrack tracked file in Git — but only in specific branch?](https://stackoverflow.com/questions/9368394/untrack-tracked-file-in-git-but-only-in-specific-branch)

<!--  -->
<br>

---

<br>
<!--  -->

# Base Command

## `branch`

### Rename local and remote branch name

```shell
# 1. Rename local branch
git branch -m new-name
# 1. If you are on a differnet branch
git branch -m old-name new-name
# 2. Delete the old-name remote branch and push the new-name local branch
git push origin :old-name new-name
# 3. Rest the upstream branch for the new-name local branch.
# Switch to the branch and then
git push origin -u new-name
```

**_References:_**

- [Blog: Rename a local and remote branch in git](https://multiplestates.wordpress.com/2015/02/05/rename-a-local-and-remote-branch-in-git/)

---

## `checkout`

## `reset`

```shell
git reset --hard <commit_id>
```

<!--  -->
<br>

---

<br>
<!--  -->

# Submodule

- [git doc: 7.11 Git Tools - Submodules](https://git-scm.com/book/en/v2/Git-Tools-Submodules)
- :thumbsup::thumbsup:[Medium: Git Submodule Cheatsheet](https://medium.com/faun/git-submodule-cheatsheet-29a3bfe443c3)

## `git submodule sync`

Synchronizes submodules' remote URL configuration setting to the value specified in `.gitmodules`.

**理解:** 更新`.gitmodules`中的一些配置信息

**_References:_**

- [stackoverflow: git submodule update vs git submodule sync](https://stackoverflow.com/questions/45678862/git-submodule-update-vs-git-submodule-sync/45679261)
- [stackoverflow: git submodule sync command - what is it for?](https://stackoverflow.com/questions/33739376/git-submodule-sync-command-what-is-it-for/33739770)

---

## Problem & Solution

### [Error] `git submodule update --init --recursive` occur `error: Server does not allow request for unadvertised object xxxx`

**Error**

```shell
error: Server does not allow request for unadvertised object 7f523de651585fe25cade462efccca647dcc8d02
Fetched in submodule path 'third_party/sleef', but it did not contain 7f523de651585fe25cade462efccca647dcc8d02. Direct fetching of that commit failed.
```

**Solution**

Run `git submodule sync` first

```shell
git submodule sync
git submodule update --init --recursive
```

**_References:_**

- :thumbsup:[Github AppImage/AppImageKit error: Server does not allow request for unadvertised object #511](https://github.com/AppImage/AppImageKit/issues/511#issuecomment-341885789)

# Git Tools

## VSCode

- Git History: show git history
- GitLens: git command
